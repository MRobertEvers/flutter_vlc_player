# Flutter VLC Fork with Recording

This is a fork of the Flutter VLC repo. This fork adds the messages to start and stop recording with the native VLC player.

See original [readme](./main-README.md).

## Android

Files are saved to App local files then moved to the media library.

In Flutter, using the `path_provider` library, the default directory that recordings are saved can be found by `getApplicationSupportDirectory();`

```
import 'package:path_provider/path_provider.dart';

void print_files() async {
  WidgetsFlutterBinding.ensureInitialized();
  final Directory directory = await getApplicationSupportDirectory();
  await for (var entity in directory.list(recursive: true, followLinks: false)) 
  {
    print(entity.path);
  }
}
```

## Notes

## Pigeons Messages

The messages are generated via `pigeon`. See here https://pub.dev/packages/pigeon. The message spec file is in `flutter_vlc_player/pigeons`. You can compile the message spec file with 

```
flutter pub run pigeon --input pigeons/messages.dart --dart_null_safety
```

## Incompatible Types Build Errors

I received several incompatible type build errors while building for android.

Not sure what the correct build steps are (they're not specified), but I had to modify several files in `FlutterVlcPlayerBuilder.java` to build successfully. (See `(Map)` and `(List)` casts)

## Request Flow

The VLC Plugin uses the standard flutter plugin patterns. Messages are used to communicate between Flutter and the platform.

On Android, example flow. Note this is just the controller. The actually widget view is drawn by the VlcPlayer widget in `flutter_vlc_player.dart` and rendered by `MethodChannelVlcPlayer.buildView` using `AndroidView` for Android or `UiKitView` for IOS. The Native widget is listening for the message to 'mount' itself, e.g. see `FlutterVlcPlayerPlugin.java`

```
(
    '_videoPlayerController'
    VlcPlayerController from vlc_player_controller.dart
).startRecord()

await (
    // Global
    'vlcPlayerPlatform' from vlc_player_platform.dart 
    // Which is defaulted to
    //   static VlcPlayerPlatform _instance = MethodChannelVlcPlayer();
    // in vlc_player_platform_interface.dart
    MethodChannelVlcPlayer from method_channel_vlc_player.dart
        implements
    VlcPlayerPlatform from vlc_player_platform_interface.dart
).startRecord()

await (
    '_api'
    // Which is autogenerated by pigeons
    VlcPlayerApi from messages.dart
).startRecord()

** 
"Fire message on `startRecord` channel" in class VlcPlayerApi from messages.dart
**

**
"receive Message on `startRecord` channel" in class Messages from messages.java
**

(
    'api'
    // Which is passed to class Messages in messages.java 
    // from FlutterVlcPlayerBuilder in FlutterVlcPlayerBuilder.java
    FlutterVlcPlayerBuilder from FlutterVlcPlayerBuilder.java
        implements
    Messages.VlcPlayerApi
).startRecord();

(
    'player'
    FlutterVlcPlayer 
).startRecord();

(
    'mediaPlayer'
    // https://code.videolan.org/videolan/vlc-android/-/blob/master/libvlc/src/org/videolan/libvlc/MediaPlayer.java
    MediaPlayer from LibVLC 
    // This is the native implementation
).startRecord();
```

The high level view

```
Controller.Command
FlutterPlatformWrapper.Command

** Fire command from Flutter Platform**
** Receive command on Native Platform**

NativePlatformWrapper.Command
Impl.Command
```
